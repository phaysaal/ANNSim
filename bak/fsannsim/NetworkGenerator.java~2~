/*
 * NetworkGenerator.java
 *
 * Created on June 7, 2006, 7:00 AM
 */

package fsannsim;

/**
 *
 * @author  Mahmud
 */
public class NetworkGenerator extends javax.swing.JInternalFrame {
    private javax.swing.JLabel lbl[];
    private javax.swing.JTextField txt[];
    Simulator sMain;
    /** Creates new form NetworkGenerator */
    public NetworkGenerator(Simulator sMain) {
        super("Network Structure Editor",true,true,true,true);
        this.sMain = sMain;
        initComponents();

        setVisible(true);
    }

    void dynamicComponents(){
        try{
            sMain.N = Integer.parseInt(txtN.getText());
            sMain.N += 2;
            lbl = new javax.swing.JLabel[sMain.N];
            txt = new javax.swing.JTextField[sMain.N];

            lbl[0] = new javax.swing.JLabel();
            txt[0] = new javax.swing.JTextField();
            txt[0].setText(sMain.I+"");
            txt[0].setEnabled(false);
            getContentPane().add(txt[0]);
            txt[0].setBounds(80, 110, 30, 20);
            lbl[0].setText("1");
            getContentPane().add(lbl[0]);
            lbl[0].setBounds(80, 90, 30, 15);

            int i;
            int x = 80;
            for(i=1; i < sMain.N; i++){
                x += 35;
                lbl[i] = new javax.swing.JLabel();
                txt[i] = new javax.swing.JTextField();
                getContentPane().add(txt[i]);
                txt[i].setBounds(x, 110, 30, 20);
                lbl[i].setText("" + (i+1));
                getContentPane().add(lbl[i]);
                lbl[i].setBounds(x, 90, 30, 15);
            }
            txt[i-1].setText(""+sMain.O);
            txt[i-1].setEnabled(false);
        }catch(Exception e){
            txtN.setText("0");
            dynamicComponents();
        }
    }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jLabel1 = new javax.swing.JLabel();
        txtN = new javax.swing.JTextField();
        btnUpdate = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        btnUpdateNetwork = new javax.swing.JButton();

        getContentPane().setLayout(null);

        jLabel1.setText("Number Of Hidden Layers:");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(10, 10, 170, 20);

        getContentPane().add(txtN);
        txtN.setBounds(180, 10, 60, 20);

        btnUpdate.setText("Update Structure");
        btnUpdate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpdateActionPerformed(evt);
            }
        });

        getContentPane().add(btnUpdate);
        btnUpdate.setBounds(250, 10, 170, 23);

        jLabel2.setText("Neurons In The Layers:");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 70, 150, 15);

        jLabel3.setText("Layers :");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(10, 90, 60, 15);

        jLabel4.setText("Neurons :");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(10, 110, 60, 20);

        jLabel5.setText("( Not Greater Than 10 )");
        getContentPane().add(jLabel5);
        jLabel5.setBounds(10, 30, 140, 20);

        btnUpdateNetwork.setText("Update Network");
        btnUpdateNetwork.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpdateNetworkActionPerformed(evt);
            }
        });

        getContentPane().add(btnUpdateNetwork);
        btnUpdateNetwork.setBounds(250, 140, 170, 23);

        setBounds(0, 0, 496, 209);
    }
    // </editor-fold>//GEN-END:initComponents
	public void init(){
		int i,j,k;
        for(i=0; i<sMain.W.length; i++){
            for(j=0; j<sMain.W[i].length; j++){
                for(k=0; k<sMain.W[i][j].length; k++){
                    sMain.W[i][j][k] = Math.random();
                }
            }
        }



        String s = sMain.vinputs;
        String t[] = s.trim().split(""+Main.inputSeperator);

        for(i=0; i<t.length; i++){
        	sMain.V[0][i] = Double.parseDouble(t[i]);
        }

        k = sMain.V.length - 1;
        s = sMain.doutputs;
        t = s.trim().split(""+Main.inputSeperator);
        //Desired output
        for(i=0; i<sMain.O; i++){
        	sMain.DO[i] = Double.parseDouble(t[i]);
        }

//		sMain.appMenu.DoSimulate(1);
		/*
		int i,j,k;
		for(i=0; i<sMain.W.length; i++)
			for(j=0; j<sMain.W[i].length; j++)
				for(k=0; k<sMain.W[i][j].length; k++)
					sMain.W[i][j][k] = i+j+k;
		*/
	}
    private void btnUpdateNetworkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpdateNetworkActionPerformed
        if(sMain.N == 0 )
        	dynamicComponents();
        sMain.W = new double[sMain.N][][];
        sMain.V = new double[sMain.N][];
        sMain.dW = new double[2][][][];
        sMain.err = new double[sMain._T][][];
        sMain.derror = new double[sMain._T];

        int i, t, s = 1, j;
        sMain.dW[0] = new double[sMain.N][][];
        sMain.dW[1] = new double[sMain.N][][];
        for(j = 0; j < sMain._T; j++){

        	sMain.err[j] = new double[sMain.N][];
    	}
    	s = 1;
        for(i = 0; i < sMain.N-1; i++){
            t = Integer.parseInt(txt[i].getText());
            s = Integer.parseInt(txt[i+1].getText());
            sMain.W[i] = new double[t][s];
            //sMain.dW[i] = new double[t][s];
            sMain.V[i] = new double[t];
            //For weight update
            sMain.dW[0][i] = new double[t][s];
            sMain.dW[1][i] = new double[t][s];
            for(j = 0; j < sMain._T; j++){

            	sMain.err[j][i] = new double[t];
        	}
        }
        for(j = 0; j < sMain._T; j++){
        	sMain.err[j][i] = new double[s];
    	}
        sMain.W[i] = new double[s][1];
        sMain.V[i] = new double[s];
        sMain.DO = new double[s];


        init();

    	sMain.mnuConfigureNetwork.setEnabled(false);
    	sMain.mnuSimulation.setEnabled(true);


        dispose();
//        sMain.appMenu.mnuSimulationActionPerformed(evt);
    }//GEN-LAST:event_btnUpdateNetworkActionPerformed

    private void btnUpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpdateActionPerformed
        dynamicComponents();
    }//GEN-LAST:event_btnUpdateActionPerformed

    /**
     * @param args the command line arguments
     */


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnUpdate;
    private javax.swing.JButton btnUpdateNetwork;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JTextField txtN;
    // End of variables declaration//GEN-END:variables

}
